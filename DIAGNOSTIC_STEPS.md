# –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º

## –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ:

‚úÖ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:** API –±–æ–ª—å—à–µ –Ω–µ –ø—ã—Ç–∞–µ—Ç—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è  
‚úÖ **–î–æ–±–∞–≤–ª–µ–Ω–æ:** –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è —Å —Å–µ—Ä–≤–µ—Ä–∞ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —ç–∫—Ä–∞–Ω–∞ "–ü—Ä–æ—Ñ–∏–ª—å"  
‚úÖ **–û–±–Ω–æ–≤–ª–µ–Ω–æ:** URL —Ç—É–Ω–Ω–µ–ª—è –≤ js/api.js  

## –®–∞–≥–∏ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏:

### 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –Ω–∞ Raspberry Pi

```bash
# –ù–∞ Raspberry Pi
cd ~/miniapp_api

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
python3 test_db.py
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
üîç –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö: /home/ubuntu/miniapp_api/app.db
üìÅ –§–∞–π–ª —Å—É—â–µ—Å—Ç–≤—É–µ—Ç: True
‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–∞–π–¥–µ–Ω–∞
üë• –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –±–∞–∑–µ: 0
‚úÖ –¢–µ—Å—Ç –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∑–∞–≤–µ—Ä—à–µ–Ω
```

### 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ .env —Ñ–∞–π–ª

```bash
# –ù–∞ Raspberry Pi
cat ~/miniapp_api/.env
```

**–£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ:**
- `BOT_TOKEN` - —Ä–µ–∞–ª—å–Ω—ã–π —Ç–æ–∫–µ–Ω –≤–∞—à–µ–≥–æ –±–æ—Ç–∞
- `ALLOWED_ORIGIN` - –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π URL –≤–∞—à–µ–≥–æ GitHub Pages
- `DB_PATH` - –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø—É—Ç—å –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

### 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ API –ª–æ–∫–∞–ª—å–Ω–æ

```bash
# –ù–∞ Raspberry Pi
cd ~/miniapp_api
source venv/bin/activate
python3 app.py
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
üöÄ –ó–∞–ø—É—Å–∫ Tsushima Mini App API...
üìÅ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö: /home/ubuntu/miniapp_api/app.db
üåê –†–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–π origin: https://–≤–∞—àusername.github.io
ü§ñ Bot token: 1234567890...
INFO:     Started server process [12345]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
INFO:     Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)
```

### 4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç—É–Ω–Ω–µ–ª—å

```bash
# –í –¥—Ä—É–≥–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ –Ω–∞ Raspberry Pi
cloudflared tunnel --url http://127.0.0.1:8000
```

**–£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ URL —Ç—É–Ω–Ω–µ–ª—è —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å —Ç–µ–º, —á—Ç–æ —É–∫–∞–∑–∞–Ω–æ –≤ js/api.js**

### 5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ API —á–µ—Ä–µ–∑ —Ç—É–Ω–Ω–µ–ª—å

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ health endpoint
curl https://nikon-easy-garbage-responded.trycloudflare.com/health

# –û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç:
{"status": "ok", "message": "Tsushima Mini App API —Ä–∞–±–æ—Ç–∞–µ—Ç"}
```

### 6. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ API

```bash
# –ù–∞ Raspberry Pi
sudo journalctl -u miniapp_api -f
```

### 7. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ –±—Ä–∞—É–∑–µ—Ä–µ

1. –û—Ç–∫—Ä–æ–π—Ç–µ Mini App –≤ Telegram
2. –ù–∞–∂–º–∏—Ç–µ F12 (–∏–ª–∏ –æ—Ç–∫—Ä–æ–π—Ç–µ Developer Tools)
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤–æ –≤–∫–ª–∞–¥–∫—É Console
4. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –Ω–∞ –æ—à–∏–±–∫–∏

## –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è:

### –ü—Ä–æ–±–ª–µ–º–∞: "–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å" –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
**–†–µ—à–µ–Ω–∏–µ:** ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ - —Ç–µ–ø–µ—Ä—å –ø—Ä–æ—Ñ–∏–ª—å –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —ç–∫—Ä–∞–Ω–∞ –ø—Ä–æ—Ñ–∏–ª—è

### –ü—Ä–æ–±–ª–µ–º–∞: "–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å"
**–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**
1. **CORS –æ—à–∏–±–∫–∞** - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ ALLOWED_ORIGIN –≤ .env
2. **401 Unauthorized** - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ BOT_TOKEN
3. **–¢—É–Ω–Ω–µ–ª—å –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç** - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ cloudflared
4. **API –Ω–µ –∑–∞–ø—É—â–µ–Ω** - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ systemd —Å–µ—Ä–≤–∏—Å

### –ü—Ä–æ–±–ª–µ–º–∞: –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è
**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ù–∞ Raspberry Pi
cd ~/miniapp_api
python3 test_db.py
```

## Systemd —Å–µ—Ä–≤–∏—Å—ã:

### –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ API —Å–µ—Ä–≤–∏—Å–∞:
```bash
sudo systemctl restart miniapp_api
sudo systemctl status miniapp_api
```

### –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Ç—É–Ω–Ω–µ–ª—è:
```bash
sudo systemctl restart cloudflared-tunnel
sudo systemctl status cloudflared-tunnel
```

## –õ–æ–≥–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏:

```bash
# –õ–æ–≥–∏ API
sudo journalctl -u miniapp_api -f

# –õ–æ–≥–∏ —Ç—É–Ω–Ω–µ–ª—è
sudo journalctl -u cloudflared-tunnel -f

# –õ–æ–≥–∏ –≤ –±—Ä–∞—É–∑–µ—Ä–µ (F12 ‚Üí Console)
```

## –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ –ø–µ—Ä–≤—É—é –æ—á–µ—Ä–µ–¥—å:

1. ‚úÖ **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å–æ–∑–¥–∞–Ω–∞** - –∑–∞–ø—É—Å—Ç–∏—Ç–µ `python3 test_db.py`
2. ‚úÖ **API –∑–∞–ø—É—â–µ–Ω** - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ `sudo systemctl status miniapp_api`
3. ‚úÖ **–¢—É–Ω–Ω–µ–ª—å —Ä–∞–±–æ—Ç–∞–µ—Ç** - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ `curl https://nikon-easy-garbage-responded.trycloudflare.com/health`
4. ‚úÖ **CORS –Ω–∞—Å—Ç—Ä–æ–µ–Ω** - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ ALLOWED_ORIGIN –≤ .env
5. ‚úÖ **BOT_TOKEN –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π** - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–æ–∫–µ–Ω –≤ .env

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —ç—Ç–∏—Ö —à–∞–≥–æ–≤ Mini App –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ!
